EpClient 输液实时监控系统（对外项目介绍）
0. 文档定位
本说明文档用于对外客户/合作方了解项目的整体能力与交付形态，重点覆盖：

项目定位与价值
总体架构与数据流
技术栈与关键组件
核心功能模块
部署交付与运维
安全与扩展性
接口对接清单（HTTP API / WebSocket）
说明：本文档不包含代码片段；接口与字段以“对接说明/占位符”形式描述，便于后续客户侧联调与验收。

1. 项目概述（项目定位与目标）
1.1 项目定位
EpClient 是一套面向病区/护士站的输液状态实时监控系统，用于集中展示床位输液过程数据（如滴速、状态、电量、输液量进度、在线状态等），并提供历史回溯与统计分析能力，帮助医护人员提升巡视效率与异常响应速度。

1.2 系统边界（重要声明）
本系统定位为“监控/展示/分析”：提供实时感知与告警提示能力，默认不包含对输液设备的“远程控制/参数下发/强制停启”等控制闭环（如需控制能力需单独评估合规与风险）。
终端设备的数据接入方式在项目中以“实时上报 → 后端统一处理 → 前端实时展示”为核心链路，支持演示模拟器用于无设备环境的展示与压测。
2. 业务场景与客户价值
2.1 典型使用场景
护士站实时大屏：集中查看当前病区床位输液状态、异常床位（过快/过慢/告警/离线）快速定位。
床旁巡视辅助：根据异常列表与趋势，优先巡视高风险床位。
历史追溯与质控：按床位、时间范围查询历史输液记录与滴速曲线，支持统计汇总（例如启动次数、总用时、总容量等）。
2.2 客户价值（可用于对外宣传）
效率提升：从“人工逐床巡视”转向“集中监控 + 异常优先”的工作方式。
风险降低：异常滴速、告警、离线等情况可实时呈现，提升响应及时性。
可追溯：关键数据落库，支持历史查询、审计与质控分析。
可扩展：采用标准化后端服务 + 实时通信机制，为后续对接 HIS/EMR/告警平台/多病区扩展提供基础。
3. 总体架构（端-服-库-屏）
3.1 架构形态
系统采用桌面客户端 + 后端服务的经典分层架构，核心特点是“实时推送”与“时序数据存储优化”。

终端/设备侧（或网关/模拟器）
上报：设备唯一标识（如 MAC）、滴速、状态、电量、在线心跳等
后端服务（Spring Boot）
对接：提供 HTTP API（管理/查询）与 WebSocket（实时推送/双向通道）
处理：设备在线判定、床位绑定、输液记录生命周期、滴速时序入库、消息广播
数据层
PostgreSQL：业务主数据与记录
TimescaleDB：滴速时序数据（Hypertable）优化查询与存储
Redis：已集成配置与序列化能力，适合作为缓存/状态/分布式能力的扩展（当前版本更偏“预留能力”）
桌面客户端（Electron + Vue3）
展示：实时床位看板、历史分析、设备管理、系统配置等
通信：HTTP 拉取 + WebSocket 实时更新
3.2 核心数据流（实时链路）
设备/模拟器产生数据 → 后端接收并进行业务处理
后端更新：
终端设备信息（在线/离线、床位绑定、最后心跳）
输液记录（开始/结束、关联终端与床位）
滴速记录（按时间序列落库）
后端通过 WebSocket 将“床位实时状态消息”广播给客户端
客户端即时刷新 UI（床位卡片、统计、告警突出显示等）
4. 技术栈与选型说明
4.1 客户端（桌面端）
Electron
用于桌面应用壳与系统能力集成
当前形态偏向大屏/固定展示：全屏、固定窗口交互
Vue 3
UI 组件化、易维护、迭代效率高
Pinia
全局状态管理（例如床位统计、主题设置等）
Vue Router
多页面路由组织（监控/历史/网络管理/配置等）
ECharts
历史统计与趋势图表展示
Vite
高性能构建与开发体验
electron-builder
桌面端打包与发布（当前工程配置更偏 Windows 交付；其他平台可按需求评估）
4.2 后端（服务端）
Java 17 + Spring Boot
稳定成熟的企业级后端框架
Spring Web（REST）
提供管理/查询类 HTTP API
Spring WebSocket
提供实时推送通道（WebSocket Endpoint）
MyBatis
数据访问层，利于复杂查询与性能调优
HikariCP
数据库连接池（高性能、稳定）
4.3 数据与中间件
PostgreSQL
关系型业务数据：终端、输液记录等
TimescaleDB（基于 PostgreSQL 扩展）
时序数据优化：滴速记录按时间高频写入、按时间范围查询
Redis
已配置连接与序列化组件，建议用于缓存热点查询、在线状态快速读写、分布式协调等（可按交付范围启用）
5. 核心功能模块（对外可讲清楚的功能清单）
5.1 实时监控大屏（床位看板）
实时展示
床位号、输液状态、设定滴速/当前滴速、电量、计时、输液量进度、在线状态
异常突出
过快/过慢/告警/离线等状态在 UI 上可快速识别（颜色/标识/优先级呈现）
实时性保障
使用 WebSocket 推送，避免传统轮询导致的延迟与压力
5.2 空闲床位/非活动床位视图
将无活动输液任务的床位独立展示，降低主屏噪音
区分两类“空闲”：
在线空闲：设备在线但当前无输液任务
离线空闲：设备离线（用于运维与风险提示）
5.3 历史记录与统计分析
历史明细查询
支持按床位、时间范围查询输液记录
滴速趋势
支持按输液记录查看滴速时间序列（用于曲线分析）
汇总统计
支持按床位聚合统计（例如启动次数、总时长、总容量等）
时间格式规范
接口侧统一采用 yyyy-MM-dd HH:mm:ss（便于客户系统对接）
5.4 终端设备与床位绑定管理
设备列表与状态
展示终端设备基础信息与在线状态
床位绑定
将设备与床位号绑定，形成“设备数据 → 床位展示”的映射
设备删除/清理
支持对无效设备记录进行清理（用于运维）
5.5 系统配置中心（可交付为“可配置化能力”）
客户端内提供集中配置入口，常见配置类别包括：

服务器连接配置
后端服务地址、端口、病区/科室标识等（对外可作为“多病区扩展”基础）
通用显示配置
床位范围、展示列数、离线阈值、告警过滤阈值等
网络/串口等配置（预留）
若未来通过网关/串口方式接入，可在此承载对接参数（需结合实际设备协议确认）
演示模式配置
演示模拟器启停、模拟设备数量等
主题与显示模式
白天/夜间/自动切换等（适配护士站大屏场景）
5.6 演示模拟器（Demo）
用于无真实设备环境下的：
功能演示
数据链路联调
性能/稳定性压测（基础级）
可通过后端配置项控制是否启用（便于生产环境关闭）
6. 实时通信（WebSocket）对接说明
6.1 WebSocket Endpoint
地址：/ws/infusion
用途：向客户端实时推送床位状态消息（也可承载双向上报，具体以设备对接方案为准）
连接策略（客户端侧）
支持断线自动重连（固定重连间隔）
6.2 实时消息字段（对接数据字典）
后端推送的“床位实时消息”包含以下字段（字段名用于对接，含义用于验收）：

字段	含义	备注
bedNumber	床位号	监控展示主键之一
infusionRecordId	输液记录 ID	关联历史记录/滴速序列
setSpeed	设定滴速（滴/分钟）	目标/设定值
currentSpeed	当前滴速（滴/分钟）	实测/当前值
status	设备/输液状态	见状态字典
statusText	状态中文说明	用于 UI 直接展示
battery	电量（%）	用于运维与风险提示
infusedVolume	已输液量（ml）	用于进度/剩余量计算
totalVolume	总量（ml）	与医嘱/设置相关
timer	计时（HH:MM:SS）	便于护士快速判断持续时间
onlineStatus	在线状态	常见：ONLINE / OFFLINE
6.3 状态字典（业务可解释口径）
status 常见取值（用于对外说明与验收）：

IDLE：空闲（无输液任务）
NORMAL：正常输液
FAST：输液过快
SLOW：输液过慢
ALARM：告警
PAUSED：暂停
COMPLETE：完成（输液结束/接近结束的业务态）
在线状态 onlineStatus：

ONLINE：在线
OFFLINE：离线
并且系统支持用组合语义区分：

IDLE + ONLINE：在线空闲（设备在线但无任务）
IDLE + OFFLINE：设备离线（不是“空闲”，而是不可用）
6.4 离线判定与可靠性策略
后端内置心跳超时策略：若设备超过 5 秒未更新心跳/上报，将被判定为离线。
离线时会触发：
设备在线状态更新为 OFFLINE
若存在进行中的输液记录，可按业务策略自动结束并通知前端刷新
7. 数据存储设计（PostgreSQL + TimescaleDB）
系统主要围绕三类核心数据：

7.1 终端设备表（Terminal Device）
用途：维护设备资产信息、在线状态、床位绑定关系、最后心跳时间等。
典型字段（概念层面）：

终端唯一标识：如设备编号、MAC
床位绑定信息：bedNumber
在线状态与最后心跳：用于离线判定
创建/更新时间：用于审计与运维
7.2 输液记录表（Infusion Record）
用途：维护每次输液任务的业务记录（床位、患者、药液、总量、开始/结束时间、持续时长、是否活动中等）。
对外价值：

可用于形成“每次输液任务”的可追溯档案
可与滴速时序数据形成关联（用于趋势回放）
7.3 滴速记录表（Drip Speed Record，时序）
用途：存储高频滴速采样点（设定滴速、当前滴速、状态、记录时间等）。
关键点：

使用 TimescaleDB 的 Hypertable 机制适配高频写入 + 按时间范围查询场景
可用于：
滴速曲线展示
输液量估算（结合采样间隔与滴速换算策略）
异常段识别与质控分析
8. HTTP API 对接清单（面向集成/管理/查询）
8.1 通用约定
Base URL：http://{后端地址}:{端口}（默认端口为 8080）
统一返回结构：Result
code：业务状态码（成功 200，其它为错误/异常）
message：提示信息
data：业务数据载荷
跨域策略
当前配置较宽松，便于开发与桌面端接入；生产交付建议按客户网络策略收敛来源与权限
8.2 终端设备管理（Terminals）
方法	路径	说明
GET	/api/terminals	获取所有终端设备列表
DELETE	/api/terminals/{terminalId}	删除指定终端设备
POST	/api/terminals/{terminalId}/bind-bed?bedNumber={n}	绑定终端与床位号
8.3 床位与历史（Beds / History）
方法	路径	说明
GET	/api/beds	获取所有“活动床位/活动输液记录”列表（用于主监控页）
GET	/api/beds/{bedNumber}	获取指定床位的活动记录视图（无活动返回对应错误）
GET	/api/beds/{bedNumber}/active	获取指定床位当前活动输液记录（实体层）
GET	/api/beds/history/summary?startTime=&endTime=	历史汇总（按床位聚合统计）
GET	/api/beds/history/{bedNumber}?startTime=&endTime=	指定床位历史明细（按开始时间排序）
GET	/api/beds/record/{id}	根据记录 ID 获取输液记录
GET	/api/beds/record/{id}/drip-speeds	获取该记录关联的滴速时序数据
8.4 输液记录（Infusion Records）
方法	路径	说明
POST	/api/infusion-records	创建输液记录（用于开始一次输液任务）
PUT	/api/infusion-records/{id}	更新输液记录（患者、药品、总量等信息）
GET	/api/infusion-records/active	获取所有活动输液记录
GET	/api/infusion-records/active/{bedNumber}	获取指定床位活动输液记录
GET	/api/infusion-records/{id}	根据 ID 获取记录
GET	/api/infusion-records/history?startTime=&endTime=&offset=&limit=	查询历史记录（时间范围、分页参数）
GET	/api/infusion-records/history/{bedNumber}?startTime=&endTime=	查询指定床位历史记录
8.5 演示模拟器（Demo）
方法	路径	说明
POST	/api/demo/start?deviceCount={n}	启动模拟器（设备数量范围建议 1~100）
POST	/api/demo/stop	停止模拟器
GET	/api/demo/status	获取模拟器运行状态
9. 部署交付方案（客户可选口径）
9.1 交付组件清单
桌面客户端安装包（Electron 打包产物）
后端服务包（Java/Spring Boot 可执行包）
数据库初始化脚本（建表、索引、TimescaleDB 初始化等）
（可选）Redis 与相关配置（用于缓存/状态扩展）
配置文件模板、部署手册、运维手册（可作为正式交付物）
9.2 典型部署模式
模式 A：单机一体（最简交付）
后端 + 数据库 + 客户端同机部署
适合：单病区试点、演示环境、PoC
模式 B：中心服务 + 多客户端
后端 + 数据库部署在病区服务器/机房服务器
多台护士站大屏/工作站客户端连接同一后端
适合：多护士站、需要统一数据与集中运维
模式 C：高可用/扩展（按需）
后端多实例、数据库主备/集群、WebSocket 粘性会话或网关支持
适合：更大规模病区/院区、对稳定性要求高
9.3 环境与依赖（建议交付要求）
后端运行环境：
Java 17
PostgreSQL（建议结合 TimescaleDB 扩展）
网络端口：HTTP 8080、WebSocket 同端口
客户端运行环境：
Windows 作为主交付环境（其他平台按需求评估）
屏幕分辨率建议按大屏场景配置
运维建议：
日志目录与磁盘容量预留
数据库备份策略与归档策略
9.4 配置项（对外口径，不暴露敏感值）
服务端口：默认 8080（可调整）
数据库连接：地址、端口、库名、账号、密码（建议通过安全方式管理）
Redis 连接：地址、端口、库/密码（可选启用）
WebSocket Endpoint：/ws/infusion
演示模拟器开关：支持通过配置控制启用/禁用